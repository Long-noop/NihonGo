<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JLPT N3 Grammar Flashcards - 120 Máº«u Ngá»¯ PhÃ¡p</title>
    <link rel="stylesheet" href="./asserts/styles.css" />
    <style>
      :root {
        --font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        --front-gradient: linear-gradient(135deg, #ffffff 0%, #f5f7fa 100%);
        --back-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --btn-accent: #667eea;
        --pattern-color: #667eea;
        --home-btn-bg: green;
        --home-btn-bg-hover: greenyellow;
      }

      /* small grammar-specific tweaks */
      .card-front h2 {
        font-size: 3em;
      }

      .card-back h3 {
        font-size: 1.8em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ“š JLPT N3 Grammar Flashcards</h1>
        <p>120 Máº«u Ngá»¯ PhÃ¡p CÆ¡ Báº£n</p>
      </div>

      <div class="card-container">
        <div class="flashcard" id="flashcard">
          <div class="card-face card-front">
            <h2 id="grammar-pattern">ï½ã“ã¨ã«ã—ã¦ã„ã‚‹</h2>
          </div>
          <div class="card-face card-back">
            <h3 id="meaning">TÃ´i quyáº¿t Ä‘á»‹nh, tÃ´i cÃ³ thÃ³i quen</h3>
            <div class="example" id="example">
              æ¯æ—¥7æ™‚ã«èµ·ãã‚‹ã“ã¨ã«ã—ã¦ã„ã¾ã™ã€‚<br />
              (TÃ´i Ä‘Ã£ quyáº¿t Ä‘á»‹nh má»—i ngÃ y dáº­y lÃºc 7 giá».)
            </div>
            <div class="audio-buttons">
              <button
                class="btn-speak"
                onclick="speakGrammarExample(event)"
                title="Äá»c cÃ¢u vÃ­ dá»¥ (chá»‰ tiáº¿ng Nháº­t)"
              >
                ğŸ”Š Nghe
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="btn btn-prev" onclick="previousCard()">â—€ TrÆ°á»›c</button>
        <button class="btn btn-flip" onclick="flipCard()">ğŸ”„ Láº­t Tháº»</button>
        <button class="btn btn-next" onclick="nextCard()">Sau â–¶</button>
      </div>

      <div class="progress">
        <div class="bar">
          <span id="current-card">1</span> / <span id="total-cards">112</span>
        </div>
      </div>

      <div class="flip-hint">ğŸ’¡ Nháº¥p vÃ o tháº» hoáº·c nháº¥n Spacebar Ä‘á»ƒ láº­t</div>
    </div>
    <a href="index.html" class="home-btn">ğŸ  Home</a>

    <script src="./data/tts.js"></script>
    <script>
      let flashcards = [];
      let currentCardIndex = 0;
      const flashcard = document.getElementById("flashcard");
      const grammarPattern = document.getElementById("grammar-pattern");
      const meaning = document.getElementById("meaning");
      const example = document.getElementById("example");
      const currentCardElement = document.getElementById("current-card");
      const totalCardsElement = document.getElementById("total-cards");

      // Function to speak only Japanese part of example
      function speakGrammarExample(event) {
        // Prevent event bubbling to flashcard
        event.stopPropagation();

        const exampleHTML = document.getElementById("example").innerHTML;
        const japaneseOnly = extractJapaneseOnly(exampleHTML);
        if (japaneseOnly) {
          speakJapanese(japaneseOnly, 0.85);
        }
      }

      // Load flashcards from JSON file
      async function loadFlashcards() {
        try {
          const response = await fetch("./data/grammar.json");
          flashcards = await response.json();
          totalCardsElement.textContent = flashcards.length;
          updateCard();
        } catch (error) {
          console.error("Error loading flashcards:", error);
          totalCardsElement.textContent = 0;
          grammarPattern.textContent = "Lá»—i táº£i dá»¯ liá»‡u";
        }
      }

      // Load flashcards when page loads
      loadFlashcards();

      function updateCard() {
        if (!flashcards || flashcards.length === 0) {
          grammarPattern.textContent = "Äang táº£i...";
          meaning.innerHTML = "";
          example.innerHTML = "";
          currentCardElement.textContent = 0;
          totalCardsElement.textContent = 0;
          flashcard.classList.remove("flipped");
          return;
        }

        const card = flashcards[currentCardIndex];
        grammarPattern.textContent = card.pattern;
        meaning.innerHTML = card.meaning;
        example.innerHTML = card.example;
        currentCardElement.textContent = currentCardIndex + 1;

        // Reset flip state
        flashcard.classList.remove("flipped");
      }

      function flipCard() {
        flashcard.classList.toggle("flipped");
      }

      function nextCard() {
        currentCardIndex = (currentCardIndex + 1) % flashcards.length;
        updateCard();
      }

      function previousCard() {
        currentCardIndex =
          (currentCardIndex - 1 + flashcards.length) % flashcards.length;
        updateCard();
      }

      // Click on card to flip
      flashcard.addEventListener("click", flipCard);

      // Keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        if (e.key === " " || e.key === "Spacebar") {
          e.preventDefault();
          flipCard();
        } else if (e.key === "ArrowLeft") {
          previousCard();
        } else if (e.key === "ArrowRight") {
          nextCard();
        }
      });
    </script>
  </body>
</html>
